<?xml version="1.0"?>
<block>
  <name>Mercurial_SDR</name>
  <key>Mercurial_SDR</key>
  <category>[Mercurial_SDR]</category>
  <import>import Mercurial_SDR</import>
  <make>Mercurial_SDR.Mercurial_SDR($modulation_key, $psk_key, $fc_key, $fs_key, $clk_key, $pammethod_key, $pamtype_key, $duty_key,$nbits_key,$am_fc_8bits_key,$am_fc_7bits_key,$am_fc_6bits_key,$am_fc_5bits_key)</make>
<callback>set_modulation($bits_key)</callback>
 <!-- Make one 'param' node for every Parameter you want settable from the GUI.
       Sub-nodes:
       * name
       * key (makes the value accessible as $keyname, e.g. in the make node)
       * type -->
    <param>
        <name>Modulation</name>
        <key>modulation_key</key>
        <value>am</value>
        <type>string</type>

        <option>
            <name>AM</name>
            <key>am</key>
        </option>

        <option>
            <name>OOK</name>
            <key>ook</key>
        </option>

        <option>
            <name>PSK</name>
            <key>psk</key>
        </option>


        <option>
            <name>PAM</name>
            <key>pam</key>
        </option>

    </param>

<!--//////////////////////////////////////////////////////////////////////-->

    <param>
        <name>Type</name>
        <key>psk_key</key>
        <value>bpsk</value>
        <type>string</type>
        <hide>#if $modulation_key() == "psk" then 'none' else 'all'#</hide>

        <option>
            <name>BPSK</name>
            <key>bpsk</key>
        </option>
    
        <option>
            <name>QPSK</name>
            <key>qpsk</key>
        </option>

        <option>
            <name>8PSK</name>
            <key>8psk</key>
        </option>
    </param>


<!--//////////////////////////////////////////////////////////////////////-->


    <param>
        <name>N Bits</name>
        <key>nbits_key</key>
        <value>8</value>
        <type>int</type>
        <hide>#if $modulation_key() == "am" then 'none' else 'all'#</hide>

        <option>
            <name>8</name>
            <key>8</key>

        </option>
    
        <option>
            <name>7</name>
            <key>7</key>
        </option>

        <option>
            <name>6</name>
            <key>6</key>
        </option>

        <option>
            <name>5</name>
            <key>5</key>
        </option>
    </param>

<!--//////////////////////////////////////////////////////////////////////-->

        <param>
        <name>Carrier Frequency</name>
        <key>am_fc_8bits_key</key>
        <value>pll_120</value>
        <type>string</type>
        <hide>#if $modulation_key() == "am" and $nbits_key() == 8 then 'none' else 'all'#</hide>

        <option>
            <name>234.37 kHz</name>
            <key>pll_60</key>
        </option>
    
        <option>
            <name>468.75 kHz</name>
            <key>pll_120</key>
        </option>

        <option>
            <name>937.5 kHz</name>
            <key>pll_240</key>
        </option>

    </param>


<!--//////////////////////////////////////////////////////////////////////-->

<!--//////////////////////////////////////////////////////////////////////-->

        <param>
        <name>Carrier Frequency</name>
        <key>am_fc_7bits_key</key>
        <value>pll_120</value>
        <type>string</type>
        <hide>#if $modulation_key() == "am" and $nbits_key() == 7 then 'none' else 'all'#</hide>

   
        <option>
            <name>468.75 kHz</name>
            <key>pll_60</key>
        </option>

        <option>
            <name>937.5 kHz</name>
            <key>pll_120</key>
        </option>


        <option>
            <name>1.875 MHz</name>
            <key>pll_240</key>
        </option>

    </param>


<!--//////////////////////////////////////////////////////////////////////-->

<!--//////////////////////////////////////////////////////////////////////-->

        <param>
        <name>Carrier Frequency</name>
        <key>am_fc_6bits_key</key>
        <value>pll_120</value>
        <type>string</type>
        <hide>#if $modulation_key() == "am" and $nbits_key() == 6 then 'none' else 'all'#</hide>

        <option>
            <name>937.5 kHz</name>
            <key>pll_60</key>
        </option>

        <option>
            <name>1.875 MHz</name>
            <key>pll_120</key>
        </option>

        <option>
            <name>3.75 MHz</name>
            <key>pll_240</key>
        </option>
    </param>


<!--//////////////////////////////////////////////////////////////////////-->



<!--//////////////////////////////////////////////////////////////////////-->

        <param>
        <name>Carrier Frequency</name>
        <key>am_fc_5bits_key</key>
        <value>pll_60</value>
        <type>string</type>
        <hide>#if $modulation_key() == "am" and $nbits_key() == 5 then 'none' else 'all'#</hide>

        <option>
            <name>1.875 MHz</name>
            <key>pll_60</key>
        </option>


    </param>




<!--//////////////////////////////////////////////////////////////////////-->

    <param>
        <name>Carrier Frequency</name>
        <key>fc_key</key>
        <value>1000000</value>
        <type>int</type>
        <hide>#if $modulation_key() == "am" or $modulation_key() == "pam"  then 'all' else 'none'#</hide>
    </param>


<!--//////////////////////////////////////////////////////////////////////-->

    <param>
        <name>Symbol Time</name>
        <key>symtime_key</key>
        <value>500000</value>
        <type>int</type>
        <hide>#if $modulation_key() == "ook" then 'none' else 'all'#</hide>
    </param>



  <!--//////////////////////////////////////////////////////////////////////-->



    <param>
        <name>Sampling Frequency</name>
        <key>fs_key</key>
        <value>44100</value>
        <type>int</type>
        <hide>#if $modulation_key() == "ook" or $modulation_key() == "pam" then 'all' else 'none'#</hide>
    </param>


 <!--/////////////////////////////////////////////////////////////////////-->


    <param>
        <name>Clk/Symbol</name>
        <key>clk_key</key>
        <value>2</value>
        <type>int</type>
        <hide>#if $modulation_key() == "am" or $modulation_key() == "pam" or $modulation_key() == "ook" then 'all' else 'none'#</hide>
    </param>

 <!--/////////////////////////////////////////////////////////////////////-->



    <param>
        <name>Type PAM</name>
        <key>pammethod_key</key>
        <value>natural_key</value>
        <type>string</type>
        <hide>#if $modulation_key() == "pam" then 'none' else 'all'#</hide>

        <option>
            <name>Flat Top</name>
            <key>flat_key</key>
        </option>

        <option>
            <name>Natural</name>
            <key>natural_key</key>
        </option>
    </param>



    <param>
        <name>Method PAM</name>
        <key>pamtype_key</key>
        <value>linear_key</value>
        <type>string</type>
        <hide>#if $modulation_key() == "pam" then 'none' else 'all'#</hide>

        <option>
            <name>Linear</name>
            <key>linear_key</key>
        </option>

        <option>
            <name>μ-Law</name>
            <key>ulaw</key>
        </option>

        <option>
            <name>A-Law</name>
            <key>alaw</key>
        </option>
    </param>



 <!--/////////////////////////////////////////////////////////////////////-->

    <param>
        <name>Sampling Frequency</name>
        <key>fs_pam_key</key>
        <value>100000</value>
        <type>int</type>
        <hide>#if $modulation_key() == "pam" then 'none' else 'all'#</hide>
    </param>

    <param>
        <name>Duty Cycle(%)</name>
        <key>duty_key</key>
        <value>50</value>
        <type>int</type>
        <hide>#if $modulation_key() == "pam" then 'none' else 'all'#</hide>
    </param>

<!--Acá van los checks-->
    <check>$fs_pam_key == 100000</check>
    <check>$duty_key &gt;= 0</check>                    <!--/Mayor o igual/-->
    <check>$duty_key &lt;= 100</check>                  <!--/Menor o igual/-->

<!--/////////////////////////////////////////////////////////////////////-->


 <!-- <param>
    <name>Duty Cycle</name>
    <key>duty_key</key>
    <value>2</value>
    <type>int</type>
    <hide>#if $modulation_key() == "am" or $modulation_key() == "pam" then 'all' else 'none'#</hide>

  </param> -->


  <!-- Make one 'sink' node per input. Sub-nodes:
       * name (an identifier for the GUI)
       * type
       * vlen
       * optional (set to 1 for optional inputs) -->
    <sink>
        <name>in_0</name>
        <type>float</type>
    </sink>

    <sink>
        <name>in_1</name>
        <type>float</type>
    </sink>

    <source>
        <name>out</name>
        <type>float</type>
    </source>

</block>
